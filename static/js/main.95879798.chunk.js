(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,i){e.exports=i(40)},38:function(e,t,i){},39:function(e,t,i){},40:function(e,t,i){"use strict";i.r(t);var n=i(11),s=i.n(n),r=i(14),c=i(1),a=i(2),d={toNumber:function(e){return e<=127?e:-(256-e)},toSignedByte:function(e){return e<0?e+256:e},hasOverflow:function(e){return e>=256},isPositive:function(e){return!this.isNegative(e)},isNegative:function(e){return!!this.getBit(e,7)},negate:function(e){return 256-e},force8Bit:function(e){return 255&e},force16Bit:function(e){return 65535&e},getBit:function(e,t){return e>>t&1},getSubNumber:function(e,t,i){return e>>t&255>>8-i},setSubNumber:function(e,t,i,n){for(var s=e,r=t;r<t+i;r++)s&=this.negate(1<<r)-1;return s|n<<t},highPartOf:function(e){return e>>8},lowPartOf:function(e){return 255&e},to16Bit:function(e,t){return this.force8Bit(e)<<8|this.force8Bit(t)}},u=i(0),o=i.n(u),l={apply:function(e){o.a.defaults(e,o.a.omit(this,"apply"))},context:null,loadContext:function(e){return this.context=e,this.onLoad&&this.onLoad(e),this},unloadContext:function(){return this.requireContext(),this.context=null,this.onUnload&&this.onUnload(),this},requireContext:function(){if(!this.context)throw new Error("Execution context not found.")}},E=i(6),g=i(5),y=i(7),h=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(c.a)(this,e),this.bytes=new t(1),this.value=this.initialValue=i}return Object(a.a)(e,[{key:"reset",value:function(){this.value=this.initialValue}},{key:"increment",value:function(){this.value++}},{key:"decrement",value:function(){this.value--}},{key:"toString",value:function(){return"[REGISTER]"}},{key:"value",get:function(){return this.bytes[0]},set:function(e){this.bytes[0]=e}}]),e}(),f=function(e){function t(e){return Object(c.a)(this,t),Object(E.a)(this,Object(g.a)(t).call(this,Uint8Array,e))}return Object(y.a)(t,e),t}(h),A=function(e){function t(e){return Object(c.a)(this,t),Object(E.a)(this,Object(g.a)(t).call(this,Uint16Array,e))}return Object(y.a)(t,e),t}(h),I=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.n=!1,this.v=!1,this.d=!1,this.i=!1,this.z=!1,this.c=!1,this.load(t)}return Object(a.a)(e,[{key:"load",value:function(e){return this.n=!!(128&e),this.v=!!(64&e),this.d=!!(8&e),this.i=!!(4&e),this.z=!!(2&e),this.c=!!(1&e),this}},{key:"toByte",value:function(){return(this.n&&128)|(this.v&&64)|32|(this.d&&8)|(this.i&&4)|(this.z&&2)|(this.c&&1)}},{key:"updateZeroAndNegative",value:function(e){this.updateZero(e),this.updateNegative(e)}},{key:"updateZero",value:function(e){this.z=0===e}},{key:"updateNegative",value:function(e){this.n=d.isNegative(e)}}]),e}(),p={apply:function(e){o.a.defaults(e,o.a.omit(this,"apply"))},readBytesAt:function(e,t){return 0===t?null:2===t?this.read2BytesAt(e):this.readAt(e)},write2BytesAt:function(e,t){var i=d.lowPartOf(t),n=d.highPartOf(t);this.writeAt(e,i),this.writeAt(e+1,n)},read2BytesAt:function(e){var t=this.readAt(e),i=this.readAt(e+1);return d.to16Bit(i,t)}},D={apply:function(e){o.a.defaults(e,o.a.omit(this,"apply")),p.apply(e)},getBytes:function(){throw new Error("not_implemented")},readAt:function(e){try{return this.getBytes().readUInt8(e)}catch(t){this._throwInvalidAddressError(e)}},writeAt:function(e,t){try{this.getBytes().writeUInt8(t,e)}catch(i){this._throwInvalidAddressError(e)}},_throwInvalidAddressError:function(e){throw new Error("Invalid memory access at 0x".concat(e.toString(16)))}},_={apply:function(e){o.a.defaults(e,o.a.omit(this,"apply")),p.apply(e),e.chunks=null},defineChunks:function(e){this.chunks=e;var t=0,i=!0,n=!1,s=void 0;try{for(var r,c=this.chunks[Symbol.iterator]();!(i=(r=c.next()).done);i=!0){var a=r.value;a.$memoryStartAddress=t,t+=a.memorySize}}catch(d){n=!0,s=d}finally{try{i||null==c.return||c.return()}finally{if(n)throw s}}this.memorySize=t},readAt:function(e){var t=this._getChunkFor(e),i=this._toRelativeAddress(e,t);return t.readAt(i)},writeAt:function(e,t){var i=this._getChunkFor(e),n=this._toRelativeAddress(e,i);return i.writeAt(n,t)},_getChunkFor:function(e){if(!this.chunks)throw new Error("Undefined chunks.");var t=!0,i=!1,n=void 0;try{for(var s,r=this.chunks[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var c=s.value,a=c.$memoryStartAddress;if(e>=a&&e<a+c.memorySize)return c}}catch(d){i=!0,n=d}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}throw new Error("Unreachable address: 0x".concat(e.toString(16),"."))},_toRelativeAddress:function(e,t){return e-t.$memoryStartAddress}},v=i(10),O=function(){function e(t){Object(c.a)(this,e),o.a.isFinite(t)&&(t=v.Buffer.alloc(t)),D.apply(this),this.bytes=t,this.memorySize=t.length}return Object(a.a)(e,[{key:"getBytes",value:function(){return this.bytes}}]),e}(),T=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.memorySize-n;Object(c.a)(this,e),p.apply(this),this.chunk=t,this.startAt=n,this.mirroredSize=s,this.memorySize=i}return Object(a.a)(e,[{key:"readAt",value:function(e){return this._checkAddress(e),this.chunk.readAt(this.startAt+e%this.mirroredSize)}},{key:"writeAt",value:function(e,t){this._checkAddress(e),this.chunk.writeAt(this.startAt+e%this.mirroredSize,t)}},{key:"_checkAddress",value:function(e){if(e>=this.memorySize)throw new Error("Unreachable address: 0x".concat(e.toString(16),"."))}}]),e}(),C=function(){function e(t){Object(c.a)(this,e),this.memorySize=t}return Object(a.a)(e,[{key:"readAt",value:function(e){return 0}},{key:"writeAt",value:function(e,t){}}]),e}(),m=function(){function e(){Object(c.a)(this,e),l.apply(this),_.apply(this)}return Object(a.a)(e,[{key:"onLoad",value:function(e){var t=e.mapper,i=new O(2048),n=new T(i,6144),s=new C(8),r=new C(8184),c=new C(24),a=new C(8);this.defineChunks([i,n,s,r,c,a,t])}},{key:"readAt",value:function(e){return e.value?e.value:_.readAt.call(this,e)}},{key:"writeAt",value:function(e,t){e.value?e.value=t:_.writeAt.call(this,e,t)}},{key:"onUnload",value:function(){this.defineChunks(null)}}]),e}(),S=function(){function e(){Object(c.a)(this,e),l.apply(this)}return Object(a.a)(e,[{key:"push",value:function(e){this.requireContext(),this.context.memory.writeAt(this.currentAddress,e),this.context.cpu.sp.decrement()}},{key:"pop",value:function(){return this.requireContext(),this.context.cpu.sp.increment(),this.context.memory.readAt(this.currentAddress)}},{key:"push2Bytes",value:function(e){var t=d.lowPartOf(e),i=d.highPartOf(e);this.push(i),this.push(t)}},{key:"pop2Bytes",value:function(e){var t=this.pop(),i=this.pop();return d.to16Bit(i,t)}},{key:"startAddress",get:function(){return 256}},{key:"currentAddress",get:function(){return this.startAddress+this.context.cpu.sp.value}}]),e}(),x=i(4),L=function(e,t){var i=e.cpu,n=i.registers.a.value,s=n+t+i.flags.c,r=d.force8Bit(s);i.registers.a.value=r,i.flags.updateZeroAndNegative(r),i.flags.c=d.hasOverflow(s),i.flags.v=d.isPositive(n)&&d.isPositive(t)&&d.isNegative(r)||d.isNegative(n)&&d.isNegative(t)&&d.isPositive(r)},N=function(e){return function(t){var i=t.cpu,n=i.registers[e];n.decrement(),i.flags.updateZeroAndNegative(n.value)}},R=function(e){return function(t){var i=t.cpu,n=i.registers[e];n.increment(),i.flags.updateZeroAndNegative(n.value)}},B=[{id:"ADC",needsValue:!0,execute:L},{id:"ASL",execute:function(e,t){var i=e.cpu,n=e.memory,s=n.readAt(t)<<1,r=d.force8Bit(s);n.writeAt(t,r),i.flags.updateZeroAndNegative(r),i.flags.c=d.hasOverflow(s)}},{id:"DEC",execute:function(e,t){var i=e.cpu,n=e.memory,s=n.readAt(t),r=d.force8Bit(s-1);i.flags.updateZeroAndNegative(r),n.writeAt(t,r)}},{id:"DEX",execute:N("x")},{id:"DEY",execute:N("y")},{id:"INC",execute:function(e,t){var i=e.cpu,n=e.memory,s=n.readAt(t),r=d.force8Bit(s+1);i.flags.updateZeroAndNegative(r),n.writeAt(t,r)}},{id:"INX",execute:R("x")},{id:"INY",execute:R("y")},{id:"LSR",execute:function(e,t){var i=e.cpu,n=e.memory,s=n.readAt(t),r=s>>1,c=d.force8Bit(r);n.writeAt(t,c),i.flags.updateZeroAndNegative(c),i.flags.c=!!d.getBit(s,0)}},{id:"ROL",execute:function(e,t){var i=e.cpu,n=e.memory,s=n.readAt(t),r=s<<1|+i.flags.c,c=d.force8Bit(r);n.writeAt(t,c),i.flags.updateZeroAndNegative(c),i.flags.c=!!d.getBit(s,7)}},{id:"ROR",execute:function(e,t){var i=e.cpu,n=e.memory,s=n.readAt(t),r=s>>1|+i.flags.c<<7,c=d.force8Bit(r);n.writeAt(t,c),i.flags.updateZeroAndNegative(c),i.flags.c=!!d.getBit(s,0)}},{id:"SBC",needsValue:!0,execute:function(e,t){return L(e,d.negate(t)-1)}}],P=function(e,t){return function(i,n){var s=i.cpu;s.flags[e]===t?(s.pc.value=n,s.extraCycles++):s.extraCycles=0}},X=[{id:"BCC",execute:P("c",!1)},{id:"BCS",execute:P("c",!0)},{id:"BEQ",execute:P("z",!0)},{id:"BMI",execute:P("n",!0)},{id:"BNE",execute:P("z",!1)},{id:"BPL",execute:P("n",!1)},{id:"BVC",execute:P("v",!1)},{id:"BVS",execute:P("v",!0)},{id:"JMP",execute:function(e,t){e.cpu.pc.value=t}},{id:"JSR",execute:function(e,t){var i=e.cpu;i.stack.push2Bytes(i.pc.value-1),i.pc.value=t}},{id:"RTI",execute:function(e){var t=e.cpu;t.flags.load(t.stack.pop()),t.pc.value=t.stack.pop2Bytes()}},{id:"RTS",execute:function(e){var t=e.cpu;t.pc.value=t.stack.pop2Bytes()+1}}],k=function(e){return function(t,i){var n=t.cpu,s=n.registers[e].value;n.flags.z=s===i,n.flags.updateNegative(d.force8Bit(s-i)),n.flags.c=s>=i}},w=[{id:"BIT",needsValue:!0,execute:function(e,t){var i=e.cpu,n=t&i.registers.a.value;i.flags.updateZero(n),i.flags.updateNegative(t),i.flags.v=!!d.getBit(t,6)}},{id:"CMP",needsValue:!0,execute:k("a")},{id:"CPX",needsValue:!0,execute:k("x")},{id:"CPY",needsValue:!0,execute:k("y")}],b=function(e){return function(t){t.cpu.flags[e]=!0}},U=function(e){return function(t){t.cpu.flags[e]=!1}},M=function(e){return function(t,i){var n=t.cpu;n.registers[e].value=i,n.flags.updateZeroAndNegative(i)}},Z=function(e){return function(t,i){var n=t.cpu,s=t.memory,r=n.registers[e].value;s.writeAt(i,r)}},j=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(n){var s=n.cpu,r=e(s).value;t(s).value=r,i&&s.flags.updateZeroAndNegative(r)}},Y=[{id:"CLC",execute:U("c")},{id:"CLD",execute:U("d")},{id:"CLI",execute:U("i")},{id:"CLV",execute:U("v")},{id:"LDA",needsValue:!0,execute:M("a")},{id:"LDX",needsValue:!0,execute:M("x")},{id:"LDY",needsValue:!0,execute:M("y")},{id:"PHA",execute:function(e){var t=e.cpu;t.stack.push(t.registers.a.value)}},{id:"PHP",execute:function(e){e.cpu.pushFlags(!0)}},{id:"PLA",execute:function(e){var t=e.cpu,i=t.stack.pop();t.registers.a.value=i,t.flags.updateZeroAndNegative(i)}},{id:"PLP",execute:function(e){var t=e.cpu;t.flags.load(t.stack.pop())}},{id:"SEC",execute:b("c")},{id:"SED",execute:b("d")},{id:"SEI",execute:b("i")},{id:"STA",execute:Z("a")},{id:"STX",execute:Z("x")},{id:"STY",execute:Z("y")},{id:"TAX",execute:j(function(e){return e.registers.a},function(e){return e.registers.x})},{id:"TAY",execute:j(function(e){return e.registers.a},function(e){return e.registers.y})},{id:"TSX",execute:j(function(e){return e.sp},function(e){return e.registers.x})},{id:"TXA",execute:j(function(e){return e.registers.x},function(e){return e.registers.a})},{id:"TXS",execute:j(function(e){return e.registers.x},function(e){return e.sp},!1)},{id:"TYA",execute:j(function(e){return e.registers.y},function(e){return e.registers.a})}],V=function(e){return function(t,i){var n=t.cpu,s=e(n.registers.a.value,i);n.registers.a.value=s,n.flags.updateZeroAndNegative(s)}},G=[{id:"AND",needsValue:!0,execute:V(function(e,t){return e&t})},{id:"EOR",needsValue:!0,execute:V(function(e,t){return e^t})},{id:"ORA",needsValue:!0,execute:V(function(e,t){return e|t})}],z=o.a.keyBy([{id:"NMI",vector:65530},{id:"RESET",vector:65532},{id:"IRQ",vector:65534}],"id"),$=[{id:"BRK",execute:function(e){e.cpu.interrupt(z.IRQ,!0)}},{id:"NOP",execute:function(e){}}],F=o.a.keyBy([].concat(Object(x.a)(B),Object(x.a)(X),Object(x.a)(w),Object(x.a)(Y),Object(x.a)(G),Object(x.a)($)),"id"),J={id:"IMPLICIT",parameterSize:0,getAddress:function(e){return null},getValue:function(){throw new Error("The IMPLICIT addressing mode only supports the `getAddress` method (and it always returns null)")}},H={id:"IMMEDIATE",parameterSize:1,getAddress:function(){throw new Error("The IMMEDIATE addressing mode only supports the `getValue` method")},getValue:function(e,t){return t}},q=function(e,t,i){var n=this.getAddress(e,t,i);return e.memory.readAt(n)},Q={id:"ABSOLUTE",parameterSize:2,getAddress:function(e,t){return t},getValue:q},K=function(e){return function(t,i,n){var s=t.cpu,r=i+s.registers[e].value;return d.highPartOf(i)!==d.highPartOf(r)&&n&&s.extraCycles++,d.force16Bit(r)}},W={id:"INDEXED_ABSOLUTE_X",parameterSize:2,getAddress:K("x"),getValue:q},ee={id:"INDEXED_ABSOLUTE_Y",parameterSize:2,getAddress:K("y"),getValue:q},te={id:"ZERO_PAGE",parameterSize:1,getAddress:function(e,t){return t},getValue:q},ie=K("x"),ne={id:"INDEXED_ZERO_PAGE_X",parameterSize:1,getAddress:function(e,t){return d.force8Bit(ie(e,t,!1))},getValue:q},se=K("y"),re={id:"INDEXED_ZERO_PAGE_Y",parameterSize:1,getAddress:function(e,t){return d.force8Bit(se(e,t,!1))},getValue:q},ce={id:"INDIRECT",parameterSize:2,getAddress:function(e,t){var i=e.memory,n=d.highPartOf(t),s=d.lowPartOf(t),r=i.readAt(t),c=i.readAt(255===s?d.to16Bit(n,0):t+1);return d.to16Bit(c,r)},getValue:q},ae=function(e,t){var i=e.memory,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},s=n(t),r=n(s+1),c=i.readAt(s),a=i.readAt(r);return d.to16Bit(a,c)},de={id:"INDEXED_INDIRECT_X",parameterSize:1,getAddress:function(e,t){return ae(e,t+e.cpu.registers.x.value,d.force8Bit)},getValue:q},ue=K("y"),oe={id:"INDEXED_INDIRECT_Y",parameterSize:1,getAddress:function(e,t,i){return ue(e,ae(e,t,d.force8Bit),i)},getValue:q},le={id:"RELATIVE",parameterSize:1,getAddress:function(e,t,i){var n=e.cpu,s=n.pc.value,r=s+d.toNumber(t);return d.highPartOf(s)!==d.highPartOf(r)&&i&&(n.extraCycles+=2),d.force16Bit(r)},getValue:q},Ee={id:"ACCUMULATOR",parameterSize:0,getAddress:function(e){return e.cpu.registers.a},getValue:function(){throw new Error("The ACCUMULATOR addressing mode only supports the `getAddress` method")}},ge=o.a.keyBy([J,H,Q,W,ee,te,ne,re,ce,de,oe,le,Ee],"id"),ye=[{id:105,instruction:F.ADC,cycles:2,addressing:ge.IMMEDIATE},{id:101,instruction:F.ADC,cycles:3,addressing:ge.ZERO_PAGE},{id:117,instruction:F.ADC,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:109,instruction:F.ADC,cycles:4,addressing:ge.ABSOLUTE},{id:125,instruction:F.ADC,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:121,instruction:F.ADC,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:97,instruction:F.ADC,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:113,instruction:F.ADC,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0},{id:10,instruction:F.ASL,cycles:2,addressing:ge.ACCUMULATOR},{id:6,instruction:F.ASL,cycles:5,addressing:ge.ZERO_PAGE},{id:22,instruction:F.ASL,cycles:6,addressing:ge.INDEXED_ZERO_PAGE_X},{id:14,instruction:F.ASL,cycles:6,addressing:ge.ABSOLUTE},{id:30,instruction:F.ASL,cycles:7,addressing:ge.INDEXED_ABSOLUTE_X},{id:198,instruction:F.DEC,cycles:5,addressing:ge.ZERO_PAGE},{id:214,instruction:F.DEC,cycles:6,addressing:ge.INDEXED_ZERO_PAGE_X},{id:206,instruction:F.DEC,cycles:6,addressing:ge.ABSOLUTE},{id:222,instruction:F.DEC,cycles:7,addressing:ge.INDEXED_ABSOLUTE_X},{id:202,instruction:F.DEX,cycles:2,addressing:ge.IMPLICIT},{id:136,instruction:F.DEY,cycles:2,addressing:ge.IMPLICIT},{id:230,instruction:F.INC,cycles:5,addressing:ge.ZERO_PAGE},{id:246,instruction:F.INC,cycles:6,addressing:ge.INDEXED_ZERO_PAGE_X},{id:238,instruction:F.INC,cycles:6,addressing:ge.ABSOLUTE},{id:254,instruction:F.INC,cycles:7,addressing:ge.INDEXED_ABSOLUTE_X},{id:232,instruction:F.INX,cycles:2,addressing:ge.IMPLICIT},{id:200,instruction:F.INY,cycles:2,addressing:ge.IMPLICIT},{id:74,instruction:F.LSR,cycles:2,addressing:ge.ACCUMULATOR},{id:70,instruction:F.LSR,cycles:5,addressing:ge.ZERO_PAGE},{id:86,instruction:F.LSR,cycles:6,addressing:ge.INDEXED_ZERO_PAGE_X},{id:78,instruction:F.LSR,cycles:6,addressing:ge.ABSOLUTE},{id:94,instruction:F.LSR,cycles:7,addressing:ge.INDEXED_ABSOLUTE_X},{id:42,instruction:F.ROL,cycles:2,addressing:ge.ACCUMULATOR},{id:38,instruction:F.ROL,cycles:5,addressing:ge.ZERO_PAGE},{id:54,instruction:F.ROL,cycles:6,addressing:ge.INDEXED_ZERO_PAGE_X},{id:46,instruction:F.ROL,cycles:6,addressing:ge.ABSOLUTE},{id:62,instruction:F.ROL,cycles:7,addressing:ge.INDEXED_ABSOLUTE_X},{id:106,instruction:F.ROR,cycles:2,addressing:ge.ACCUMULATOR},{id:102,instruction:F.ROR,cycles:5,addressing:ge.ZERO_PAGE},{id:118,instruction:F.ROR,cycles:6,addressing:ge.INDEXED_ZERO_PAGE_X},{id:110,instruction:F.ROR,cycles:6,addressing:ge.ABSOLUTE},{id:126,instruction:F.ROR,cycles:7,addressing:ge.INDEXED_ABSOLUTE_X},{id:233,instruction:F.SBC,cycles:2,addressing:ge.IMMEDIATE},{id:229,instruction:F.SBC,cycles:3,addressing:ge.ZERO_PAGE},{id:245,instruction:F.SBC,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:237,instruction:F.SBC,cycles:4,addressing:ge.ABSOLUTE},{id:253,instruction:F.SBC,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:249,instruction:F.SBC,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:225,instruction:F.SBC,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:241,instruction:F.SBC,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0}],he=[{id:144,instruction:F.BCC,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:176,instruction:F.BCS,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:240,instruction:F.BEQ,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:48,instruction:F.BMI,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:208,instruction:F.BNE,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:16,instruction:F.BPL,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:80,instruction:F.BVC,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:112,instruction:F.BVS,cycles:2,addressing:ge.RELATIVE,canTakeExtraCycles:!0},{id:76,instruction:F.JMP,cycles:3,addressing:ge.ABSOLUTE},{id:108,instruction:F.JMP,cycles:5,addressing:ge.INDIRECT},{id:32,instruction:F.JSR,cycles:6,addressing:ge.ABSOLUTE},{id:64,instruction:F.RTI,cycles:6,addressing:ge.IMPLICIT},{id:96,instruction:F.RTS,cycles:6,addressing:ge.IMPLICIT}],fe=[{id:36,instruction:F.BIT,cycles:3,addressing:ge.ZERO_PAGE},{id:44,instruction:F.BIT,cycles:4,addressing:ge.ABSOLUTE},{id:201,instruction:F.CMP,cycles:2,addressing:ge.IMMEDIATE},{id:197,instruction:F.CMP,cycles:3,addressing:ge.ZERO_PAGE},{id:213,instruction:F.CMP,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:205,instruction:F.CMP,cycles:4,addressing:ge.ABSOLUTE},{id:221,instruction:F.CMP,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:217,instruction:F.CMP,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:193,instruction:F.CMP,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:209,instruction:F.CMP,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0},{id:224,instruction:F.CPX,cycles:2,addressing:ge.IMMEDIATE},{id:228,instruction:F.CPX,cycles:3,addressing:ge.ZERO_PAGE},{id:236,instruction:F.CPX,cycles:4,addressing:ge.ABSOLUTE},{id:192,instruction:F.CPY,cycles:2,addressing:ge.IMMEDIATE},{id:196,instruction:F.CPY,cycles:3,addressing:ge.ZERO_PAGE},{id:204,instruction:F.CPY,cycles:4,addressing:ge.ABSOLUTE}],Ae=[{id:24,instruction:F.CLC,cycles:2,addressing:ge.IMPLICIT},{id:216,instruction:F.CLD,cycles:2,addressing:ge.IMPLICIT},{id:88,instruction:F.CLI,cycles:2,addressing:ge.IMPLICIT},{id:184,instruction:F.CLV,cycles:2,addressing:ge.IMPLICIT},{id:169,instruction:F.LDA,cycles:2,addressing:ge.IMMEDIATE},{id:165,instruction:F.LDA,cycles:3,addressing:ge.ZERO_PAGE},{id:181,instruction:F.LDA,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:173,instruction:F.LDA,cycles:4,addressing:ge.ABSOLUTE},{id:189,instruction:F.LDA,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:185,instruction:F.LDA,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:161,instruction:F.LDA,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:177,instruction:F.LDA,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0},{id:162,instruction:F.LDX,cycles:2,addressing:ge.IMMEDIATE},{id:166,instruction:F.LDX,cycles:3,addressing:ge.ZERO_PAGE},{id:182,instruction:F.LDX,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_Y},{id:174,instruction:F.LDX,cycles:4,addressing:ge.ABSOLUTE},{id:190,instruction:F.LDX,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:160,instruction:F.LDY,cycles:2,addressing:ge.IMMEDIATE},{id:164,instruction:F.LDY,cycles:3,addressing:ge.ZERO_PAGE},{id:180,instruction:F.LDY,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:172,instruction:F.LDY,cycles:4,addressing:ge.ABSOLUTE},{id:188,instruction:F.LDY,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:72,instruction:F.PHA,cycles:3,addressing:ge.IMPLICIT},{id:8,instruction:F.PHP,cycles:3,addressing:ge.IMPLICIT},{id:104,instruction:F.PLA,cycles:4,addressing:ge.IMPLICIT},{id:40,instruction:F.PLP,cycles:4,addressing:ge.IMPLICIT},{id:56,instruction:F.SEC,cycles:2,addressing:ge.IMPLICIT},{id:248,instruction:F.SED,cycles:2,addressing:ge.IMPLICIT},{id:120,instruction:F.SEI,cycles:2,addressing:ge.IMPLICIT},{id:133,instruction:F.STA,cycles:3,addressing:ge.ZERO_PAGE},{id:149,instruction:F.STA,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:141,instruction:F.STA,cycles:4,addressing:ge.ABSOLUTE},{id:157,instruction:F.STA,cycles:5,addressing:ge.INDEXED_ABSOLUTE_X},{id:153,instruction:F.STA,cycles:5,addressing:ge.INDEXED_ABSOLUTE_Y},{id:129,instruction:F.STA,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:145,instruction:F.STA,cycles:6,addressing:ge.INDEXED_INDIRECT_Y},{id:134,instruction:F.STX,cycles:3,addressing:ge.ZERO_PAGE},{id:150,instruction:F.STX,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_Y},{id:142,instruction:F.STX,cycles:4,addressing:ge.ABSOLUTE},{id:132,instruction:F.STY,cycles:3,addressing:ge.ZERO_PAGE},{id:148,instruction:F.STY,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:140,instruction:F.STY,cycles:4,addressing:ge.ABSOLUTE},{id:170,instruction:F.TAX,cycles:2,addressing:ge.IMPLICIT},{id:168,instruction:F.TAY,cycles:2,addressing:ge.IMPLICIT},{id:186,instruction:F.TSX,cycles:2,addressing:ge.IMPLICIT},{id:138,instruction:F.TXA,cycles:2,addressing:ge.IMPLICIT},{id:154,instruction:F.TXS,cycles:2,addressing:ge.IMPLICIT},{id:152,instruction:F.TYA,cycles:2,addressing:ge.IMPLICIT}],Ie=[{id:41,instruction:F.AND,cycles:2,addressing:ge.IMMEDIATE},{id:37,instruction:F.AND,cycles:3,addressing:ge.ZERO_PAGE},{id:53,instruction:F.AND,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:45,instruction:F.AND,cycles:4,addressing:ge.ABSOLUTE},{id:61,instruction:F.AND,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:57,instruction:F.AND,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:33,instruction:F.AND,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:49,instruction:F.AND,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0},{id:73,instruction:F.EOR,cycles:2,addressing:ge.IMMEDIATE},{id:69,instruction:F.EOR,cycles:3,addressing:ge.ZERO_PAGE},{id:85,instruction:F.EOR,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:77,instruction:F.EOR,cycles:4,addressing:ge.ABSOLUTE},{id:93,instruction:F.EOR,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:89,instruction:F.EOR,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:65,instruction:F.EOR,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:81,instruction:F.EOR,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0},{id:9,instruction:F.ORA,cycles:2,addressing:ge.IMMEDIATE},{id:5,instruction:F.ORA,cycles:3,addressing:ge.ZERO_PAGE},{id:21,instruction:F.ORA,cycles:4,addressing:ge.INDEXED_ZERO_PAGE_X},{id:13,instruction:F.ORA,cycles:4,addressing:ge.ABSOLUTE},{id:29,instruction:F.ORA,cycles:4,addressing:ge.INDEXED_ABSOLUTE_X,canTakeExtraCycles:!0},{id:25,instruction:F.ORA,cycles:4,addressing:ge.INDEXED_ABSOLUTE_Y,canTakeExtraCycles:!0},{id:1,instruction:F.ORA,cycles:6,addressing:ge.INDEXED_INDIRECT_X},{id:17,instruction:F.ORA,cycles:5,addressing:ge.INDEXED_INDIRECT_Y,canTakeExtraCycles:!0}],pe=[{id:0,instruction:F.BRK,cycles:0,addressing:ge.IMPLICIT},{id:234,instruction:F.NOP,cycles:2,addressing:ge.IMPLICIT}],De=o.a.keyBy([].concat(Object(x.a)(ye),Object(x.a)(he),Object(x.a)(fe),Object(x.a)(Ae),Object(x.a)(Ie),Object(x.a)(pe)),"id"),_e=function(){function e(){Object(c.a)(this,e),l.apply(this),this.pc=new A,this.sp=new f,this.flags=new I,this.cycle=0,this.extraCycles=0,this.registers={a:new f(0),x:new f(0),y:new f(0)},this.memory=new m,this.stack=new S,this._parameter=null}return Object(a.a)(e,[{key:"onLoad",value:function(e){this.memory.loadContext(e),this.stack.loadContext(e),this._reset()}},{key:"step",value:function(){this.requireContext();var e=this.pc.value,t=this._readOperation(),i=this._readParameter(t);this.context.logger&&this.context.logger.log({context:this.context,pc:e,operation:t,initialParameter:this._parameter,finalParameter:i}),t.instruction.execute(this.context,i),this.cycle+=t.cycles+this.extraCycles,this.extraCycles=0}},{key:"interrupt",value:function(e,t){("IRQ"!==e.id||this._areInterruptsEnabled)&&(this.stack.push2Bytes(this.pc.value),this.pushFlags(t),this.cycle+=7,this.flags.i=!0,this._jumpToInterruptHandler(e))}},{key:"pushFlags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stack.push(this.flags.toByte()|(e&&16))}},{key:"onUnload",value:function(){this._reset(),this.stack.unloadContext(),this.memory.unloadContext()}},{key:"_reset",value:function(){this.pc.reset(),this.sp.reset(),this.flags.load(36),this.cycle=0,this.extraCycles=0,this.registers.a.reset(),this.registers.x.reset(),this.registers.y.reset(),this._parameter=null,this.interrupt(z.RESET)}},{key:"_readOperation",value:function(){var e=this.memory.readAt(this.pc.value),t=De[e];if(!t)throw new Error("Unknown opcode: 0x".concat(e.toString(16)));return this.pc.increment(),t}},{key:"_readParameter",value:function(e){var t=e.instruction,i=e.addressing,n=e.canTakeExtraCycles,s=this.memory.readBytesAt(this.pc.value,i.parameterSize);return this.pc.value+=i.parameterSize,this._parameter=s,t.needsValue?i.getValue(this.context,s,n):i.getAddress(this.context,s,n)}},{key:"_jumpToInterruptHandler",value:function(e){this.pc.value=this.memory.read2BytesAt(e.vector)}},{key:"_areInterruptsEnabled",get:function(){return!this.flags.i}}]),e}(),ve=i(8),Oe=16384,Te=function(e){function t(e){var i;Object(c.a)(this,t),i=Object(E.a)(this,Object(g.a)(t).call(this,e)),_.apply(Object(ve.a)(Object(ve.a)(i)));var n=new C(16352),s=new O(e.prgRom.slice(0,Oe)),r=2===e.header.prgRomPages?new O(e.prgRom.slice(Oe,2*Oe)):new T(s,16384);return i.defineChunks([n,s,r]),i}return Object(y.a)(t,e),Object(a.a)(t,null,[{key:"id",get:function(){return 0}}]),t}(function(){function e(){Object(c.a)(this,e)}return Object(a.a)(e,null,[{key:"id",get:function(){throw new Error("not_implemented")}}]),e}()),Ce=o.a.keyBy([Te],"id"),me="NES",Se=function(){function e(t){if(Object(c.a)(this,e),this.bytes=t,this.magicNumber!==me)throw new Error("Invalid ROM format.")}return Object(a.a)(e,[{key:"createMapper",value:function(){return new Ce[this.header.mapperId](this)}},{key:"_getBytes",value:function(e,t){return this.bytes.slice(e,e+t)}},{key:"prgRom",get:function(){return this._getBytes(this._programOffset,this._programSize)}},{key:"chrRom",get:function(){var e=this._programOffset+this._programSize,t=8192*this.header.chrRomPages;return t>0?this._getBytes(e,t):null}},{key:"header",get:function(){if(this.__header)return this.__header;var e=this.bytes.readUInt8(6),t=this.bytes.readUInt8(7);return this.__header={prgRomPages:this.bytes.readUInt8(4),chrRomPages:this.bytes.readUInt8(5),hasTrainerBeforeProgram:!!d.getBit(e,2),mapperId:d.setSubNumber(d.getSubNumber(e,4,4),4,4,d.getSubNumber(t,4,4))}}},{key:"magicNumber",get:function(){return Array.from(this._getBytes(0,3)).map(function(e){return String.fromCharCode(e)}).join("")}},{key:"_programOffset",get:function(){return 16+(this.header.hasTrainerBeforeProgram?512:0)}},{key:"_programSize",get:function(){return 16384*this.header.prgRomPages}}]),e}(),xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(c.a)(this,e),l.apply(this),this.logger=t,this.cpu=new _e}return Object(a.a)(e,[{key:"load",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new Se(e);this.loadContext({logger:this.logger,cpu:this.cpu,memory:this.cpu.memory,cartridge:t,mapper:t.createMapper()})}},{key:"step",value:function(){this.cpu.step()}},{key:"unload",value:function(){this.unloadContext()}},{key:"onLoad",value:function(e){this.cpu.loadContext(this.context),this._reset()}},{key:"onUnload",value:function(){this._reset()}},{key:"_reset",value:function(){}}]),e}(),Le=function(e,t){return o.a.padStart(e.toString(16).toUpperCase(),t,"0")},Ne={log:function(e){var t=e.context,i=e.pc,n=e.operation,s=e.initialParameter,r=e.finalParameter,c=t.cpu,a=t.memory,u=function(e,t){return o.a.padStart(e.toString(),t)},l=function(e,t){return o.a.padEnd(e.substr(0,t),t)},E=function(e){return 0===n.addressing.parameterSize?"":2===n.addressing.parameterSize?Le(e,4):Le(e,2)},g=l(Le(i,4),6),y=Le(n.id,2),h=" ";n.addressing.parameterSize>0&&(h+=2===n.addressing.parameterSize?Le(d.lowPartOf(s),2)+" "+Le(d.highPartOf(s),2):Le(s,2));var f=l(y+h,10),A=l(n.instruction.id+" "+function(){var e=E(s),i=E(r),u=null;try{u=n.addressing.getAddress(t,s)}catch(g){}switch(n.addressing.id){case"IMPLICIT":return"";case"IMMEDIATE":return"#$".concat(i);case"ABSOLUTE":var l="$".concat(e);return o.a.includes(["STA","STX","STY","LDA","LDX","LDY","BIT","ORA","AND","EOR","ADC","SBC","CMP","CPX","CPY","LSR","ASL","ROR","ROL","INC","DEC"],n.instruction.id)&&(l+=" = ".concat(Le(a.readAt(u),2))),l;case"ZERO_PAGE":return"$".concat(e," = ").concat(Le(a.readAt(u),2));case"INDEXED_ABSOLUTE_X":case"INDEXED_ZERO_PAGE_X":return"$".concat(e,",X @ ").concat(E(u)," = ").concat(Le(a.readAt(u),2));case"INDEXED_ABSOLUTE_Y":case"INDEXED_ZERO_PAGE_Y":return"$".concat(e,",Y @ ").concat(E(u)," = ").concat(Le(a.readAt(u),2));case"INDIRECT":return"($".concat(e,") = ").concat(Le(u,4));case"INDEXED_INDIRECT_X":return"($".concat(e,",X) @ ").concat(Le(d.force8Bit(s+c.registers.x.value),2)," = ").concat(Le(u,4)," = ").concat(Le(a.readAt(u),2));case"INDEXED_INDIRECT_Y":return"($".concat(e,"),Y = ").concat(Le(ae(t,s,d.force8Bit),4)," @ ").concat(Le(u,4)," = ").concat(Le(a.readAt(u),2));case"ACCUMULATOR":return"A";default:return"$".concat(i)}}(),32),I=["a","x","y"].map(function(e){return e.toUpperCase()+":"+Le(c.registers[e].value,2)}).join(" ")+" P:"+Le(c.flags.toByte(),2)+" SP:"+Le(c.sp.value,2),p="PPU:"+u(0,3)+","+u(1,3),D="CYC:"+c.cycle,_="".concat(I," ").concat(p," ").concat(D);window.lastLog=g+f+A+_,console.log(window.lastLog)}},Re=i(3),Be=i.n(Re),Pe=i(15),Xe=i.n(Pe),ke=i(16),we=i.n(ke),be=(i(38),function(e){function t(){var e,i;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(i=Object(E.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(s)))).state={expected:"",actual:""},i.onStep=function(e){if("Enter"===e.code){for(var t=[],n=0;n<10;n++)t.push(window.getDiff());i.setState({expected:o()(t).map("expected").join("\n"),actual:o()(t).map("actual").join("\n")})}},i}return Object(y.a)(t,e),Object(a.a)(t,[{key:"componentWillMount",value:function(){document.addEventListener("keydown",this.onStep)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onStep)}},{key:"render",value:function(){return Be.a.createElement("div",{className:"app"},Be.a.createElement("div",null,Be.a.createElement("div",{className:"debugger",onKeyDown:this.onStep},Be.a.createElement(we.a,{oldValue:this.state.expected,newValue:this.state.actual,splitView:!0})),Be.a.createElement("div",{className:"titles"},Be.a.createElement("h1",{className:"title"},"NesTest"),Be.a.createElement("h1",{className:"title"},"NesCore")),Be.a.createElement("i",{className:"hint"},"Enter => Next page")))}}]),t}(Re.Component));i(39);Xe.a.render(Be.a.createElement(be,null),document.getElementById("root")),function(){var e=Object(r.a)(s.a.mark(function e(){var t,i,n,r,c,a,d,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("testroms/nestest.nes");case 2:return t=e.sent,e.next=5,t.arrayBuffer();case 5:return i=e.sent,n=v.Buffer.from(i),window.bytes=n,window.nes=new xe(Ne),window.nes.load(n),window.nes.cpu.pc.value=49152,e.next=13,fetch("testroms/nestest.log");case 13:return r=e.sent,e.next=16,r.text();case 16:c=e.sent,a=c.split(/\n|\r\n|\r/),d=function(e){return e&&e.replace(/PPU: *\d+, *\d+ CYC:/,"CYC:")},u=0,window.getDiff=function(){window.nes.step();var e={actual:d(window.lastLog),expected:d(a[u])};return u++,e};case 21:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()}},[[19,1,2]]]);
//# sourceMappingURL=main.95879798.chunk.js.map